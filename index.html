
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check-in Page Mock</title>
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <div class="phone">
        <div class="pattern"></div>

        <div class="top-actions">
            <div class="round-btn" aria-label="Close">
                <!-- X icon -->
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path
                        d="M18.3 5.7a1 1 0 0 0-1.4 0L12 10.6 7.1 5.7a1 1 0 1 0-1.4 1.4l4.9 4.9-4.9 4.9a1 1 0 1 0 1.4 1.4l4.9-4.9 4.9 4.9a1 1 0 0 0 1.4-1.4L13.4 12l4.9-4.9a1 1 0 0 0 0-1.4z" />
                </svg>
            </div>

            <div class="round-btn" aria-label="Share">
                <!-- share icon -->
                <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path
                        d="M18 16a3 3 0 0 0-2.4 1.2l-6-3.2a3.2 3.2 0 0 0 0-1.9l6-3.2A3 3 0 1 0 15 6a3 3 0 0 0 .1.7l-6 3.2A3 3 0 1 0 9 14a3 3 0 0 0-.1.7l6 3.2A3 3 0 1 0 18 16z" />
                </svg>
            </div>
        </div>

        <div class="card">
            <div class="profile-wrapper">
                <div class="image-circle">

                    <img src="assets/1639592262853.jfif" alt="Profile Photo" />

                    <svg class="ring ring--dashed" viewBox="0 0 110 110">
                        <circle cx="55" cy="55" r="52" />
                    </svg>

                    <!-- animated dotted ring -->
                    <svg class="ring ring--dots" viewBox="0 0 125 125">
                        <circle cx="62.5" cy="62.5" r="59.5" />
                    </svg>
                </div>
            </div>

            <div class="header">
                <h1 class="title"><span class="titleVal">Behzad Chizari</span> • 873334992</h1>
                <p class="subtitle">Check-in: Dec 20, 13:14 · 00:00:18</p>
            </div>

            <div class="rows">
                <div class="row">
                    <div class="left">
                        <div class="icon" aria-hidden="true">
                            <!-- location pin -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M12 2a7 7 0 0 0-7 7c0 5.3 7 13 7 13s7-7.7 7-13a7 7 0 0 0-7-7zm0 9.5A2.5 2.5 0 1 1 12 6a2.5 2.5 0 0 1 0 5.5z" />
                            </svg>
                        </div>
                        <div class="label">Venue</div>
                    </div>
                    <div class="value">Holmes Place am Seestern</div>
                </div>

                <div class="row">
                    <div class="left">
                        <div class="icon" aria-hidden="true">
                            <!-- clipboard icon -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M16 4h-1.2A3 3 0 0 0 12 2a3 3 0 0 0-2.8 2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm-4-1a1 1 0 0 1 1 1h-2a1 1 0 0 1 1-1zm4 17H8V6h1.5v1h5V6H16v14z" />
                            </svg>
                        </div>
                        <div class="label">Activity</div>
                    </div>
                    <div class="value">Fitness</div>
                </div>

                <div class="row">
                    <div class="left">
                        <div class="icon" aria-hidden="true">
                            <!-- tag icon -->
                            <svg viewBox="0 0 24 24">
                                <path
                                    d="M20.6 13.4 12 22 2 12l8.6-8.6A2 2 0 0 1 12 3h6a2 2 0 0 1 2 2v6a2 2 0 0 1-.6 1.4zM17.5 8A1.5 1.5 0 1 0 16 6.5 1.5 1.5 0 0 0 17.5 8z" />
                            </svg>
                        </div>
                        <div class="label">Category</div>
                    </div>
                    <div class="value">Fitness</div>
                </div>
            </div>
        </div>

    </div>

    <!-- ✅ Scripts: persistence for edits; timer not stored; reset via Close button -->
    <script>
        // ---------- Storage keys ----------
        const STORAGE_KEYS = {
            title: 'checkin_title',
            venue: 'checkin_venue',
            photo: 'checkin_photo_dataurl'
            // NOTE: No startTs key -> we do not store the counter/timer in storage
        };

        // ---------- Baseline (original) values captured at load ----------
        const BASELINE = {
            titleText: null,
            venueText: null,
            photoSrc: null
        };

        // ---------- Helpers ----------
        // Format date like the provided example: "Jan 12 19:25" (24h, no comma)
        function formatDateLikeExample(date) {
            const options = {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            return date.toLocaleString('en-US', options).replace(',', '');
        }

        // Format seconds as "HH:MM:SS"
        function formatHMS(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0');
            const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        // ---------- Date & Timer (NOT persisted) ----------
        let timerId = null;

        function initCheckinTimeNoPersistence() {
            const subtitleEl = document.querySelector('.subtitle');
            if (!subtitleEl) return;

            // Pin to current date-time on each load
            const pinnedDateText = formatDateLikeExample(new Date());

            // Start from zero on load
            let elapsedSeconds = 0;
            subtitleEl.textContent = `Check-in: ${pinnedDateText} · ${formatHMS(elapsedSeconds)}`;

            // Clear any old interval and start new one
            if (timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                elapsedSeconds++;
                subtitleEl.textContent = `Check-in: ${pinnedDateText} · ${formatHMS(elapsedSeconds)}`;
            }, 1000);
        }

        function resetCheckinTimeToNowNoPersistence() {
            const subtitleEl = document.querySelector('.subtitle');
            if (!subtitleEl) return;

            const pinnedDateText = formatDateLikeExample(new Date());
            let elapsedSeconds = 0;
            subtitleEl.textContent = `Check-in: ${pinnedDateText} · ${formatHMS(elapsedSeconds)}`;

            if (timerId) clearInterval(timerId);
            timerId = setInterval(() => {
                elapsedSeconds++;
                subtitleEl.textContent = `Check-in: ${pinnedDateText} · ${formatHMS(elapsedSeconds)}`;
            }, 1000);
        }

        // ---------- Title editing (click to change) with persistence ----------
        function enableTitleEditing() {
            const titleSpan = document.querySelector('span.titleVal');
            if (!titleSpan) return;

            // Capture baseline once
            if (BASELINE.titleText === null) {
                BASELINE.titleText = titleSpan.textContent;
            }

            // Restore saved title (span only)
            const savedTitle = localStorage.getItem(STORAGE_KEYS.title);
            if (savedTitle) titleSpan.textContent = savedTitle;

            titleSpan.style.cursor = 'pointer';
            titleSpan.title = 'Click to edit title';

            titleSpan.addEventListener('click', () => {
                const current = titleSpan.textContent.trim();
                const next = prompt('Enter new title (name):', current);
                if (next && next.trim()) {
                    const clean = next.trim();
                    titleSpan.textContent = clean;
                    localStorage.setItem(STORAGE_KEYS.title, clean);
                    document.title = `Check-in • ${clean}`;
                }
            });
        }

        function restoreTitleToBaseline() {
            const titleSpan = document.querySelector('span.titleVal');
            if (!titleSpan) return;
            titleSpan.textContent = BASELINE.titleText ?? titleSpan.textContent;
            document.title = 'Check-in Page Mock';
            localStorage.removeItem(STORAGE_KEYS.title);
        }

        // ---------- Profile image upload (click the image) with persistence ----------
        function enableProfileImageUpload() {
            const profileImg = document.querySelector('.image-circle img');
            if (!profileImg) return;

            // Capture baseline once
            if (BASELINE.photoSrc === null) {
                BASELINE.photoSrc = profileImg.getAttribute('src');
            }

            // Restore saved photo
            const savedPhoto = localStorage.getItem(STORAGE_KEYS.photo);
            if (savedPhoto) profileImg.src = savedPhoto;

            profileImg.style.cursor = 'pointer';
            profileImg.title = 'Click to change photo';

            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            document.body.appendChild(fileInput);

            profileImg.addEventListener('click', () => {
                fileInput.click();
            });

            fileInput.addEventListener('change', (evt) => {
                const file = evt.target.files && evt.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    const dataUrl = e.target.result;
                    profileImg.src = dataUrl;
                    try {
                        localStorage.setItem(STORAGE_KEYS.photo, dataUrl);
                    } catch (err) {
                        console.warn('Saving photo to localStorage failed (size may be too large):', err);
                    }
                };
                reader.readAsDataURL(file);
            });
        }

        function restorePhotoToBaseline() {
            const profileImg = document.querySelector('.image-circle img');
            if (!profileImg) return;
            const fallback = BASELINE.photoSrc || profileImg.getAttribute('src');
            profileImg.src = fallback;
            localStorage.removeItem(STORAGE_KEYS.photo);
        }

        // ---------- Venue editing (click the venue value) with persistence ----------
        function findVenueValueElement() {
            const rows = document.querySelectorAll('.rows .row');
            for (const row of rows) {
                const labelEl = row.querySelector('.label');
                const valueEl = row.querySelector('.value');
                if (labelEl && valueEl && labelEl.textContent.trim().toLowerCase() === 'venue') {
                    return valueEl;
                }
            }
            return null;
        }

        function enableVenueEditing() {
            const venueValueEl = findVenueValueElement();
            if (!venueValueEl) return;

            // Capture baseline once
            if (BASELINE.venueText === null) {
                BASELINE.venueText = venueValueEl.textContent;
            }

            // Restore saved venue
            const savedVenue = localStorage.getItem(STORAGE_KEYS.venue);
            if (savedVenue) venueValueEl.textContent = savedVenue;

            venueValueEl.style.cursor = 'pointer';
            venueValueEl.title = 'Click to change venue';

            venueValueEl.addEventListener('click', () => {
                const currentVenue = venueValueEl.textContent.trim();
                const nextVenue = prompt('Enter new venue name:', currentVenue);
                if (nextVenue && nextVenue.trim()) {
                    const clean = nextVenue.trim();
                    venueValueEl.textContent = clean;
                    localStorage.setItem(STORAGE_KEYS.venue, clean);
                }
            });
        }

        function restoreVenueToBaseline() {
            const venueValueEl = findVenueValueElement();
            if (!venueValueEl) return;
            venueValueEl.textContent = BASELINE.venueText || venueValueEl.textContent;
            localStorage.removeItem(STORAGE_KEYS.venue);
        }

        // ---------- Reset everything when Close button is clicked ----------
        function setupCloseButtonReset() {
            const closeBtn = document.querySelector('.top-actions .round-btn[aria-label="Close"]');
            if (!closeBtn) return;

            closeBtn.style.cursor = 'pointer';
            closeBtn.title = 'Reset changes';

            closeBtn.addEventListener('click', () => {
                // Clear persisted values for editable elements (NOT timer)
                localStorage.removeItem(STORAGE_KEYS.title);
                localStorage.removeItem(STORAGE_KEYS.venue);
                localStorage.removeItem(STORAGE_KEYS.photo);

                // Restore UI to original baseline values
                restoreTitleToBaseline();
                restoreVenueToBaseline();
                restorePhotoToBaseline();

                // Reset check-in time to now and restart timer (no persistence)
                resetCheckinTimeToNowNoPersistence();
            });
        }

        // ---------- Initialize on DOM ready ----------
        window.addEventListener('DOMContentLoaded', () => {
            // Capture baselines before any restoration
            enableTitleEditing();
            enableVenueEditing();
            enableProfileImageUpload();

            // Init time & timer (not persisted)
            initCheckinTimeNoPersistence();

            // Close button triggers full reset
            setupCloseButtonReset();
        });
    </script>
</body>

</html>
